<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Board</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

{% if messages %}
    <div class = "container mt-3">
        {%for message in messages%}
        <div class="alert alert-success" role = "alert"> {{message}} 
            <button type = "button" class = "btn-close" data-bs-dismiss = "alert"></button>
        </div>
        {%endfor%}
    </div>
    {%endif%}


<div class="container my-4">
    <h2 class="mb-3">Community Board</h2>
    <a href="{% url 'create_post' %}" class="btn btn-primary mb-4">+ Share Something</a>

    {% for post in posts %}
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <p class="mb-1">
                    <b>
                    {% if post.anonymous_name %}
                        {{ post.anonymous_name }}
                    {% elif post.author %}
                        {{ post.author.username }}
                    {% else %}
                        Unknown User
                    {% endif %}
                    </b>
                    <span class="text-muted">‚Ä¢ {{ post.category }}</span>
                </p>
                <p class="card-text">{{ post.content }}</p>
                <p class="text-muted mb-2">
                    üëç {{ post.reactions.count }} | üí¨ {{ post.comments.count }}
                </p>

                <!-- Like Form -->
                <form method="post" action="{% url 'like_post' post.id %}" class="d-inline">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-outline-primary">Like</button>
                </form>

                <!-- Comment Form -->
                <form action="{% url 'add_comment' post.id %}" method="post" class="mt-2">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="text" name="content" placeholder="Write a comment..." class="form-control">
                        <button class="btn btn-success">Comment</button>
                    </div>
                </form>

                <!-- Comments List -->
                {% for comment in post.comments.all %}
                    <div class="mt-2 ms-3 border-start ps-2">
                        <p class="mb-0">
                            üí¨ <b>{{ comment.anonymous_name|default:comment.author.username }}</b>: {{ comment.content }}
                        </p>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% empty %}
        <p class="text-muted">No posts yet. Be the first one to share something positive!</p>
    {% endfor %}
</div>

<!-- Bootstrap JS CDN -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
